<div align="center" dir="rtl">

# 02 - بيان المشكلة (Problem Statement)

## التحديات التي شكلت SourceShan

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

## مقدمة

قبل بناء الحل، نحتاج إلى فهم المشكلة بعمق. تستكشف هذه الوثيقة التحديات التي قادت تصميم SourceShan—من نقاط الألم العملية إلى القيود التقنية.

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

## المشكلة الجوهرية

### إدارة المحافظ اليدوية لا تتوسع

عندما بدأت في بناء المحافظ للعملاء، كان سير العمل مباشراً:

1. يصف العميل ما يريده
2. أقوم ببناء المحفظة
3. أقوم بتسليمها (منشورة على Vercel، والكود على GitHub)
4. يستخدمها العميل

ولكن بعد ذلك جاءت الطلبات:

- *"هل يمكنك إضافة هذا المشروع الجديد؟"*
- *"هل يمكنك تحديث سيرتي الذاتية؟"*
- *"هل يمكنك تبديل هذه الصور؟"*

كل طلب تطلب مني:
1. تبديل السياق (Context switch) عما كنت أعمل عليه
2. سحب (Pull) مستودع العميل
3. إجراء التغييرات
4. الدفع والنشر (Push and deploy)
5. التأكيد مع العميل

لعميل واحد، كان هذا قابلاً للإدارة. لعملاء متعددين، أصبح الأمر غير مستدام.

### الأثر

| من | الأثر |
|-----|--------|
| **العملاء** | اضطروا لانتظاري. غالباً أيام من أجل تغييرات بسيطة. |
| **أنا** | تشتت سياق مستمر. عمل منخفض القيمة. |
| **العمل** | لم يتوسع. الإيرادات لكل عميل كانت محدودة بشكل مصطنع. |

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

## أبعاد المشكلة

كان الحل بحاجة لمعالجة عدة مشاكل مترابطة:

### 1. مشكلة استقلالية المستخدم

**العرض:** لا يستطيع العملاء تحديث محافظهم دون مساعدة المطور.

**السبب الجذري:** كانت المحافظ كوداً ثابتاً، وليست محتوى مداراً.

**المتطلب:** نظام يمكن للعملاء غير التقنيين من خلاله:
- إضافة/تعديل/حذف عناصر المحفظة
- رفع وإدارة الصور
- إعادة ترتيب المحتوى
- معاينة التغييرات
- نشر التحديثات

**القيد:** يجب أن يكون بديهياً بما يكفي لمستخدمين غير تقنيين لم يستخدموا CMS من قبل.

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

### 2. مشكلة تعدد العملاء (Multi-Tenancy)

**العرض:** يحتاج كل عميل لبيئته المعزولة الخاصة.

**السبب الجذري:** مشاركة المنصة تتطلب عزلاً قوياً للبيانات.

**المتطلب:** نظام حيث:
- يستخدم عملاء متعددون نفس المنصة
- يرى كل عميل بياناته فقط
- لا يمكن لعميل الوصول لمحتوى عميل آخر
- يمكن للمسؤول الإشراف على جميع العملاء

**القيد:** يجب فرض العزل في كل طبقة—واجهة المستخدم، API، وقاعدة البيانات.

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

### 3. مشكلة الأمان

**العرض:** فتح النظام للعملاء يقدم مخاطر أمنية.

**السبب الجذري:** مستخدمون أكثر = سطح هجوم أكبر.

**المتطلبات:**

| المطلب الأمني | لماذا يهم |
|---------------------|----------------|
| مصادقة قوية | منع الوصول غير المصرح به |
| أمان الجلسة | منع سرقة الجلسة (Hijacking) |
| الوصول القائم على الأدوار | صلاحيات مختلفة للمسؤولين مقابل العملاء |
| تدوير التوكن | تقليل الضرر في حال سرقة الرموز |
| التحقق من المدخلات | منع هجمات الحقن (Injection) |

**القيد:** لا يمكن للأمان أن يضر بتجربة المستخدم. التحديث الصامت للتوكن ضرورة.

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

### 4. مشكلة بنية Serverless التحتية

**العرض:** معمارية Vercel serverless لها قيود فريدة.

**الأسباب الجذرية:**
- كل طلب قد يشغل مثيل Lambda جديد
- لا اتصالات دائمة بين الطلبات
- البدايات الباردة (Cold starts) تؤثر على الأداء

**تحديات محددة:**

```
┌─────────────────────────────────────────────────────────────┐
│                  SERVERLESS CHALLENGES                       │
├─────────────────────────────────────────────────────────────┤
│  • Connection Pooling: 100+ connections quickly exhausted   │
│  • Cold Starts: First request in a Lambda is slow          │
│  • State: No shared memory between invocations             │
│  • Edge Limitations: Fewer APIs available in Edge Runtime  │
└─────────────────────────────────────────────────────────────┘
```

**المتطلب:** يجب أن تعمل المعمارية ضمن هذه القيود، لا أن تحاربها.

**القيد:** يجب استخدام Vercel (محافظ العملاء منشورة هناك بالفعل).

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

### 5. مشكلة اتساق البيانات

**العرض:** تحديثات المحفظة غالباً ما تتضمن ملفات متعددة.

**السبب الجذري:** "حفظ" واحد قد يُحدث:
- `projects.json` (بيانات وصفية)
- `public/images/project-1.webp` (صورة جديدة)
- `public/images/old-image.webp` (محذوفة)

**الخطر:**

```
تسلسل التحديث (النهج التقليدي):
1. تحديث projects.json        ✅ نجاح
2. رفع صورة جديدة            ✅ نجاح
3. حذف الصورة القديمة            ❌ فشل!

النتيجة: البيانات الآن غير متسقة
- projects.json يشير للصورة الجديدة
- الصورة الجديدة موجودة
- الصورة القديمة لا تزال موجودة (يتيمة)
- العميل يرى حالة مكسورة
```

**المتطلب:** كل التغييرات يجب أن تكون ذرية (Atomic)—تنجح كلها أو لا شيء.

**القيد:** واجهة برمجة تطبيقات GitHub القياسية لكل ملف، ليست ذرية.

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

### 6. مشكلة تطور المخطط (Schema Evolution)

**العرض:** متطلبات المحفظة تتغير بمرور الوقت.

**أمثلة:**
- العميل يريد إضافة قسم شهادات
- حقل جديد مطلوب لروابط الفيديو
- محفظة مختلفة قد تحتاج لحقول مختلفة

**المشكلة التقليدية:**

```
النهج التقليدي:
1. العميل يطلب حقلاً جديداً
2. تحديث مخطط قاعدة البيانات
3. تحديث نقاط نهاية API
4. تحديث مكون واجهة المستخدم للمحرر
5. تحديث التحقق
6. نشر كل شيء

الوقت: ساعات لأيام
الخطر: عالي (تغييرات متعددة)
```

**المتطلب:** إضافة حقول جديدة يجب أن يكون تغيير تكوين (configuration)، وليس تغيير كود.

**القيد:** يجب أن يعمل لهياكل محافظ مختلفة (كل عميل فريد).

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

### 7. مشكلة تجربة المستخدم

**العرض:** أدوات المؤسسات غالباً ما تكون معقدة وقبيحة.

**السبب الجذري:** أدوات المطورين تعطي الأولوية للوظيفة على الشكل.

**المتطلبات:**

| متطلب UX | المبرر |
|---------------|-----------|
| تنقل بديهي | المستخدمون غير التقنيين يجب أن يفهموه |
| تغذية راجعة بصرية | حركات، إشعارات، حالات تحميل |
| دعم ثنائي اللغة | محتوى عربي (RTL) وإنجليزي (LTR) |
| استجابة للموبايل | العملاء يتحققون من هواتفهم |
| جمالية متميزة | تعكس جودة محفظتهم |

**القيد:** الجمالية لا يمكن أن تضحي بالأداء.

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

## تقاطع المشاكل

هذه المشاكل لا توجد في عزلة—إنها تتفاعل:

```
                    ┌─────────────────┐
                    │   Multi-Tenant  │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              ▼              ▼              ▼
        ┌───────────┐  ┌───────────┐  ┌───────────┐
        │ Security  │  │  Data     │  │   UX      │
        │           │◄─┤ Isolation │─►│           │
        └─────┬─────┘  └───────────┘  └─────┬─────┘
              │                             │
              │    ┌───────────────┐        │
              └───►│  Performance  │◄───────┘
                   └───────┬───────┘
                           │
           ┌───────────────┼───────────────┐
           ▼               ▼               ▼
     ┌───────────┐  ┌───────────────┐  ┌───────────┐
     │Serverless │  │  Atomicity   │  │  Schema   │
     │Constraints│  │              │  │ Evolution │
     └───────────┘  └───────────────┘  └───────────┘
```

**تقاطعات رئيسية:**

- **الأمان + تعدد العملاء**: RBAC في كل طبقة
- **UX + Serverless**: الأداء رغم البدايات الباردة
- **الذرية + المخطط**: الحفظ المعقد يجب أن يكون ذرياً
- **الأمان + UX**: تحديث التوكن يجب أن يكون غير مرئي

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

## كيف يبدو النجاح

قبل الغوص في الحل، دعنا نحدد معايير النجاح:

### يجب أن يكون (Must Have)

- [ ] يمكن للعملاء تسجيل الدخول بأمان
- [ ] يمكن للعملاء رؤية محافظهم فقط
- [ ] يمكن للعملاء تحديث المحتوى دون كود
- [ ] التحديثات ذرية (لا حفظ جزئي)
- [ ] النظام يعمل على Vercel serverless

### ينبغي أن يكون (Should Have)

- [ ] يمكن للمسؤولين إدارة العملاء
- [ ] تغييرات المخطط لا تتطلب تغييرات كود
- [ ] المحرر يبدو متميزاً (حركات سلسة)
- [ ] تصميم مستجيب للموبايل
- [ ] دعم ثنائي اللغة

### من الجيد أن يكون (Nice to Have)

- [ ] معاينة قبل النشر
- [ ] سجل الإصدارات
- [ ] تكامل التحليلات
- [ ] إشعارات البريد الإلكتروني

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

## ترتيب أولويات المشاكل

بناءً على الأثر والاعتماديات، تم التعامل مع المشاكل بهذا الترتيب:

| الأولوية | المشكلة | المبرر |
|----------|---------|-----------|
| 1 | الأمان | الأساس. يصعب إضافته لاحقاً. |
| 2 | تعدد العملاء | قرار معمارية جوهري. |
| 3 | قيود Serverless | يجب العمل ضمن البنية التحتية. |
| 4 | الذرية | سلامة البيانات غير قابلة للتفاوض. |
| 5 | تطور المخطط | قابلية التوسع تعتمد عليه. |
| 6 | تجربة المستخدم | مهمة، لكن تبنى فوق ما سبق. |

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

## ملخص القيود

يجب أن يعمل الحل ضمن هذه القيود:

### قيود تقنية

| القيد | المصدر |
|------------|--------|
| يجب استخدام Vercel | بنية تحتية موجودة |
| يجب استخدام GitHub للمتوى | فائدة التحكم في الإصدار |
| يجب العمل في Edge Runtime | متطلب الأداء |
| يجب استخدام MongoDB | اختيار قاعدة بيانات موجود |

### قيود غير تقنية

| القيد | المصدر |
|------------|--------|
| مطور منفرد | محدودية الموارد |
| العملاء غير تقنيين | متطلب UX |
| محتوى عربي + إنجليزي | متطلب السوق |
| لا تسجيل إجباري | فلسفة UX |

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

## الطريق للأمام

فهم هذه المشاكل بعمق شكل كل قرار معماري في SourceShan. الوثيقة التالية، **[معمارية الحل](03-solution-architecture.md)**، تشرح كيف تمت معالجة كل مشكلة.

النقاط الرئيسية:
- المشاكل تتفاعل—حل واحدة قد يخلق أو يحل أخرى
- القيود ميزات—تجبر على حلول إبداعية
- الأمان أولاً—الترقيع لاحقاً أصعب من البناء المضمن

<div align="center">
<img width="600" src="https://raw.githubusercontent.com/andreasbm/readme/master/assets/lines/aqua.png"/>
</div>

<div align="center">

[![Prev: Overview](https://img.shields.io/badge/←_Prev:_Overview-5042a5?style=for-the-badge)](01-overview.md) [![Next: Solution Architecture](https://img.shields.io/badge/Next:_Solution_Architecture_→-4a45ea?style=for-the-badge)](03-solution-architecture.md)

</div>
